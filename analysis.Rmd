---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
```

```{r}
variants=read_tsv("2018.01.15_ZIKV-iSNV/variants.tsv")
```

```{r}
barcode1=read_tsv("BC01.variants.freqs.txt")
barcode1$replica = 'a'
barcode2=read_tsv("BC02.variants.freqs.txt")
barcode2$replica = 'b'
barcode3=read_tsv("BC03.variants.freqs.txt")
barcode3$replica = 'c'
minion=rbind(barcode1, barcode2, barcode3)
minion %>%
    filter(Qual == 0) %>%
    write_tsv(path="minion_variants.tsv")
```

```{r}
ggplot(minion, aes(x=Freq)) + geom_histogram(bins=100)
```



```{r}
snps = variants %>%
 filter(startsWith(`Polymorphism Type`, 'SNP'))
joined = inner_join(snps, minion, by=c("Minimum" = "Pos"))
```

```{r}
filtered = joined %>%
  filter(Qual == 14) %>%
  filter(replica.x == replica.y) %>%
  filter(modality == 'amplicon')

fit = lm(filtered$Freq ~ filtered$freq)
summary(fit)
```


```{r}
p = joined %>% 
  filter(Qual == 10) %>%
  filter(modality == 'amplicon') %>%
  ggplot(aes(x=Freq, y=freq)) + geom_point(size=0.2) + geom_smooth() + xlim(0, 0.5) + ylim(0, 0.5) + xlab("Nanopore allele freq") + ylab("Illumina allele freq") + facet_wrap(~replica.x~modality) + theme_bw(base_size=14)
p
```

```{r}
expectedpositions=read_tsv("refs/expectedpositions.txt")

```

```{r}
a=inner_join(joined, expectedpositions, by=c("Minimum" = "Pos")) %>%
  filter(Qual == 0) %>%
  filter(modality == 'amplicon') %>%
  filter(replica.x == replica.y) %>%
  ggplot(aes(x=Freq, y=freq)) + geom_point(size=0.2) + geom_density2d() + xlim(0, 0.5) + ylim(0, 0.5) + xlab("Nanopore allele freq") + ylab("Illumina allele freq") + facet_wrap(~replica.x~modality) + theme_bw(base_size=14)
a
```

```{r}
snps = variants %>%
 filter(startsWith(`Polymorphism Type`, 'SNP'))

joined = inner_join(snps, snps, by="Minimum")

joined %>%
 filter(replica.x == replica.y) %>%
 filter(modality.x != modality.y) %>%
 ggplot(aes(x=freq.x, y=freq.y)) + geom_jitter(size=0.5) + facet_wrap(~replica.x)
``` 
